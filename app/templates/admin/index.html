{% extends "base.html" %}

{% block title %}管理员控制台{% endblock %}

{% block content %}
<div class="container">
    <h1>管理员控制台</h1>
    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-people fs-3 me-2"></i>
                        <h5 class="card-title mb-0">用户管理</h5>
                    </div>
                    <p class="card-text">管理系统用户</p>
                    <a href="{{ url_for('admin.users') }}" class="btn btn-primary">
                        <i class="bi bi-person-gear"></i> 管理用户
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-gear fs-3 me-2"></i>
                        <h5 class="card-title mb-0">系统设置</h5>
                    </div>
                    <p class="card-text">配置系统参数</p>
                    <a href="{{ url_for('admin.settings') }}" class="btn btn-primary">
                        <i class="bi bi-sliders"></i> 修改设置
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <i class="bi bi-journal-text fs-3 me-2"></i>
                        <h5 class="card-title mb-0">系统日志</h5>
                    </div>
                    <p class="card-text">查看系统日志</p>
                    <button class="btn btn-primary" onclick="viewLogs()">
                        <i class="bi bi-file-text"></i> 查看日志
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="logsModal" tabindex="-1" aria-labelledby="logsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="logsModalLabel">系统日志</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="logs-container" style="max-height: 500px; overflow-y: auto;">
                    <pre id="logsContent" style="white-space: pre-wrap;"></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" onclick="refreshLogs()">刷新</button>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    transition: transform 0.2s;
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card:hover {
    transform: translateY(-5px);
}

.card-body {
    padding: 1.5rem;
}

.bi {
    color: #0d6efd;
}

.fs-3 {
    font-size: 1.75rem !important;
}

.me-2 {
    margin-right: 0.5rem !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.btn i {
    margin-right: 0.25rem;
}

.logs-container {
    background-color: #f8f9fa;
    padding: 1rem;
    border-radius: 0.25rem;
    font-family: monospace;
    font-size: 0.9rem;
}

#logsContent {
    margin: 0;
}
</style>

{% block scripts %}
<script>
async function viewLogs() {
    try {
        const response = await fetch('/admin/logs');
        if (!response.ok) {
            throw new Error('Failed to fetch logs');
        }
        const data = await response.json();
        
        // 格式化日志内容
        const logsContent = document.getElementById('logsContent');
        logsContent.textContent = data.logs;
        
        // 显示模态框
        const modal = new bootstrap.Modal(document.getElementById('logsModal'));
        modal.show();
    } catch (error) {
        console.error('Error fetching logs:', error);
        alert('获取日志失败：' + error.message);
    }
}

async function refreshLogs() {
    try {
        const response = await fetch('/admin/logs');
        if (!response.ok) {
            throw new Error('Failed to fetch logs');
        }
        const data = await response.json();
        
        // 更新日志内容
        const logsContent = document.getElementById('logsContent');
        logsContent.textContent = data.logs;
    } catch (error) {
        console.error('Error refreshing logs:', error);
        alert('刷新日志失败：' + error.message);
    }
}
</script>
{% endblock %}
{% endblock %} 